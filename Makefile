include .env

MIGRATIONS_DIR=migrations
MIGRATE_BIN=migrate
MIGRATE_CREATE=$(MIGRATE_BIN) create -ext sql -dir $(MIGRATIONS_DIR) -seq

.PHONY: migrate

migrate:
	@if [ -z "$(name)" ]; then \
		echo "‚ùå –£–∫–∞–∂–∏ –∏–º—è –º–∏–≥—Ä–∞—Ü–∏–∏: make migrate name=create_table"; \
		exit 1; \
	fi; \
	echo "üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏: $(name)"; \
	$(MIGRATE_CREATE) $(name)

migration_up: 
	migrate -path migrations -database $(DATABASE_URL) -verbose up

migration_down: 
	migrate -path migrations -database $(DATABASE_URL) -verbose down

migration_fix: 
	migrate -path migrations -database $(DATABASE_URL) force VERSION