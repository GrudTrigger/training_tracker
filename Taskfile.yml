version: "3"

vars:
  BACKEND_DIR: "./backend"
  FRONTEND_DIR: "./frontend"

tasks:
  format:
    desc: "–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ backend —Å –ø–æ–º–æ—â—å—é gofumpt + gci"
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - |
        echo '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ gofumpt...'
        gofumpt -w ./

        echo '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ gci...'
        gci write ./ -s standard -s default

        echo '‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ - —É—Å–ø–µ—à–Ω–æ'
  lint:
    desc: "–ó–∞–ø—É—Å–∫–∞–µ—Ç golangci-lint"
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - golangci-lint run
  goa:gen:
    desc: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏ swagger —Å –ø–æ–º–æ—â—å—é Goa"
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - |
        goa gen github.com/GrudTrigger/training_tracker/backend/design
        echo '‚úÖ GOA: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ'
  dev:up:
    desc: "–ó–∞–ø—É—Å–∫–∞ develop –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ docker –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
    cmds:
      - |
        docker compose -f docker-compose.dev.yaml up --build --detach
        echo 'üìã SWAGGER -> localhost:8081'
  dev:down:
    desc: "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –≤ —Ä–µ–∂–∏–º–µ develop"
    cmds:
      - docker compose -f docker-compose.dev.yaml down --volumes
